services:
  phobert-sentiment:
    build:
      context: .
      dockerfile: ./dockerfiles/phobert-sentiment/Dockerfile
      secrets:
        - env
    container_name: phobert-sentiment
    ports:
      - "8135:8135"
    restart: unless-stopped
    depends_on:
      - rdrsegmenter
      # rdrsegmenter:
      #   condition: service_healthy
    environment:
      RDRSEGMENTER_BASE_URL: http://rdrsegmenter:8024

  rdrsegmenter:
    build:
      context: .
      dockerfile: ./dockerfiles/rdrsegmenter/Dockerfile
    container_name: rdrsegmenter
    # Maybe no need to make it public
    # ports:
    #   - "8024:8024"
    restart: unless-stopped
    # healthcheck:
    #   test: ["CMD-SHELL", "curl -s http://localhost:8024/v1/segment --http1.1 -X POST -H 'Content-Type: text/plain' -d 'Xin chào các bạn yêu quý! Chúng tôi rất trân trọng tình cảm của các bạn' >/dev/null 2>&1 || exit 1"]
    #   interval: 10s
    #   timeout: 5s
    #   retries: 3
    #   start_period: 10s

secrets:
  env:
    file: ./docker.env
